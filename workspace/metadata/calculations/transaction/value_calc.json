{
  "calc_id": "value_calc",
  "name": "Value Calculation",
  "layer": "transaction",
  "description": "Calculates the monetary value of each execution based on instrument type. Stock: price × quantity. Option: premium × contract_size × quantity. Default: price × quantity.",
  "inputs": [
    {
      "source_type": "entity",
      "entity_id": "execution",
      "fields": ["execution_id", "product_id", "account_id", "trader_id", "side", "price", "quantity", "execution_date", "execution_time"]
    },
    {
      "source_type": "entity",
      "entity_id": "product",
      "fields": ["instrument_type", "asset_class", "contract_size"]
    }
  ],
  "output": {
    "table_name": "calc_value",
    "fields": [
      {"name": "execution_id", "type": "varchar"},
      {"name": "product_id", "type": "varchar"},
      {"name": "account_id", "type": "varchar"},
      {"name": "trader_id", "type": "varchar"},
      {"name": "side", "type": "varchar"},
      {"name": "price", "type": "decimal"},
      {"name": "quantity", "type": "decimal"},
      {"name": "instrument_type", "type": "varchar"},
      {"name": "asset_class", "type": "varchar"},
      {"name": "execution_date", "type": "varchar"},
      {"name": "execution_time", "type": "varchar"},
      {"name": "calculated_value", "type": "decimal"}
    ]
  },
  "logic": "SELECT e.execution_id, e.product_id, e.account_id, e.trader_id, e.side, e.price, e.quantity, p.instrument_type, p.asset_class, e.execution_date, e.execution_time, CASE WHEN p.instrument_type IN ('call_option', 'put_option') THEN e.price * COALESCE(p.contract_size, 100) * e.quantity WHEN p.instrument_type = 'future' THEN e.price * COALESCE(p.contract_size, 1) * e.quantity ELSE e.price * e.quantity END AS calculated_value FROM execution e INNER JOIN product p ON e.product_id = p.product_id",
  "parameters": {},
  "display": {
    "format": "currency",
    "label": "Transaction Value"
  },
  "value_field": "calculated_value",
  "depends_on": []
}
