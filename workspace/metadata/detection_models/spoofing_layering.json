{
  "model_id": "spoofing_layering",
  "name": "Spoofing / Layering",
  "description": "Detects spoofing and layering patterns where an account places multiple orders on one side (which are subsequently cancelled) while executing on the opposite side. Requires a cancellation pattern (MUST_PASS) and evaluates opposite-side execution activity.",
  "time_window": "cancellation_pattern",
  "granularity": ["product_id", "account_id"],
  "calculations": [
    {
      "calc_id": "cancel_pattern",
      "strictness": "MUST_PASS",
      "threshold_setting": "cancel_count_threshold",
      "score_steps_setting": null,
      "value_field": "cancel_count"
    },
    {
      "calc_id": "opposite_side_execution",
      "strictness": "OPTIONAL",
      "threshold_setting": null,
      "score_steps_setting": "large_activity_score_steps",
      "value_field": "total_value"
    }
  ],
  "context_fields": ["product_id", "account_id", "business_date", "asset_class", "instrument_type", "pattern_side"],
  "score_threshold_setting": "spoofing_score_threshold",
  "query": "SELECT cp.product_id, cp.account_id, cp.pattern_date AS business_date, cp.cancel_count, cp.cancel_quantity, cp.pattern_side, cp.window_start, cp.window_end, ta.total_value, ta.buy_value, ta.sell_value, p.asset_class, p.instrument_type FROM calc_cancellation_pattern cp LEFT JOIN calc_large_trading_activity ta ON cp.product_id = ta.product_id AND cp.account_id = ta.account_id INNER JOIN product p ON cp.product_id = p.product_id WHERE cp.cancel_count >= 3",
  "alert_template": {
    "title": "Spoofing / Layering Alert",
    "sections": ["business_description", "entity_context", "cancellation_analysis", "order_book_snapshot", "calculation_trace", "score_breakdown", "order_timeline"]
  },
  "regulatory_coverage": [
    {
      "regulation": "MAR",
      "article": "Art. 12(1)(c)",
      "description": "Spoofing — orders with no intention to execute"
    },
    {
      "regulation": "Dodd-Frank",
      "article": "§747",
      "description": "Anti-manipulation — spoofing prohibition"
    },
    {
      "regulation": "MiFID II",
      "article": "RTS 25",
      "description": "Order record keeping — cancellation pattern analysis"
    }
  ],
  "alert_detail_layout": {
    "panels": ["business", "entity", "calcTrace", "scores", "relatedOrders", "marketData"],
    "emphasis": ["relatedOrders", "scores"],
    "investigation_hint": "Look for rapid order placement and cancellation patterns — spoofing typically shows large orders placed and cancelled within seconds to move prices."
  },
  "market_data_config": {
    "chart_type": "candlestick",
    "time_field": "timestamp",
    "price_fields": {"open": "open", "high": "high", "low": "low", "close": "close"},
    "volume_field": "volume",
    "overlay_trades": false
  }
}
